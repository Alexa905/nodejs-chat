{"version":3,"sources":["webpack:///webpack/bootstrap 9697886717c7c220873b","webpack:///./public/scripts/ws-client.js","webpack:///./public/scripts/event-handler.js","webpack:///./public/scripts/dom.js","webpack:///./public/scripts/history.js","webpack:///./public/scripts/request.js","webpack:///./public/scripts/clients.js","webpack:///./public/scripts/message.js"],"names":["window","WebSocket","document","body","innerHTML","host","location","ws","indexOf","socket","helper","require","clientsHelper","init","onopen","currentUser","getCurrentUser","connectUser","showClients","onerror","e","send","onclose","isClientOnline","disconnectUser","onmessage","event","handleMessage","module","exports","domHelper","historyHelper","messageHelper","input","getElementById","sendBtn","signUpBtn","logInBtn","logOutBtn","imgElement","userAvatar","removeUserBtn","isTyping","sessionStorage","getItem","setCurrentUser","username","setItem","addEventListener","handleImages","changeAvatar","logIn","submitMessage","signUp","removeUser","keyCode","preventDefault","msg","createMessage","setTimeout","JSON","stringify","incomingMessage","parse","data","type","text","showMessage","connectClient","disconnectClient","setClientAvatar","form","forms","nickname","elements","value","password","isClientExists","then","isClientNew","addClient","alert","isClientAuthorized","user","confirmation","confirm","removeClient","unlock","showHistory","updateHistory","lock","file","files","reader","FileReader","result","msgAdmin","readAsDataURL","msgsBlock","chat","offlineImgSrc","defaultImgSrc","createClient","fragment","createDocumentFragment","messageElem","appendChild","createElement","img","info","status","statusText","online","createTextNode","name","className","imgSrc","avatar","replace","setAttribute","classList","add","updateClientStatus","clientsInfo","querySelectorAll","forEach","call","el","querySelector","addMessage","messageInfo","messageText","messageInfoName","messageInfoTime","date","author","removeAttribute","toggle","src","requestHelper","getHistory","request","time","Date","dateStr","toLocaleDateString","timeStr","toLocaleTimeString","console","log","length","messages","msgBlock","style","display","i","insertBefore","firstChild","scrollArea","scrollTop","scrollHeight","url","method","Promise","resolve","reject","req","XMLHttpRequest","open","onload","response","Error","setRequestHeader","param","object","encodedString","prop","hasOwnProperty","encodeURI","getClients","clients","key","updateData","updateClient","now","contains","submitBotMessage","botMsgs","Math","floor","random","msg2"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 9697886717c7c220873b\n **/","if (!window.WebSocket) {\r\n    document.body.innerHTML = 'WebSocket is not supported in this browser.';\r\n}\r\nvar host = document.location.host;\r\nvar ws = host.indexOf('localhost') !== -1 ? 'ws' : 'wss';\r\nvar socket = new WebSocket(ws + '://' + host);\r\nvar helper = require('./event-handler')(socket);\r\nvar clientsHelper = require('./clients')();\r\n\r\nhelper.init();\r\n\r\nsocket.onopen = () => {\r\n    var currentUser = helper.getCurrentUser();\r\n    currentUser ? helper.connectUser(currentUser) : clientsHelper.showClients();\r\n};\r\nsocket.onerror = (e) => {\r\n    socket.send('error' + e);\r\n};\r\nsocket.onclose = () => {\r\n    if (clientsHelper.isClientOnline(helper.getCurrentUser())) {\r\n        helper.disconnectUser();\r\n    }\r\n};\r\nsocket.onmessage = (event) => {\r\n    helper.handleMessage(event);\r\n\r\n};\r\n\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/ws-client.js\n **/","module.exports = function (socket) {\r\n    var domHelper = require('./dom')();\r\n    var historyHelper = require('./history')();\r\n    var clientsHelper = require('./clients')();\r\n    var messageHelper = require('./message')(socket);\r\n    var input = document.getElementById(\"messageTxt\");\r\n    var sendBtn = document.getElementById(\"sendMessage\");\r\n    var signUpBtn = document.getElementById(\"signUpBtn\");\r\n    var logInBtn = document.getElementById(\"logInBtn\");\r\n    var logOutBtn = document.getElementById(\"logOutBtn\");\r\n    var imgElement = document.getElementById(\"imgElem\");\r\n    var userAvatar = document.getElementById(\"avatarImg\");\r\n    var removeUserBtn = document.getElementById(\"removeUser\");\r\n    var isTyping = false;\r\n    return {\r\n        getCurrentUser () {\r\n            return sessionStorage.getItem('currentUser');\r\n        },\r\n        setCurrentUser (username = '') {\r\n            document.getElementById('currentUser').innerHTML = username;\r\n            sessionStorage.setItem('currentUser', username);\r\n        },\r\n        init () {\r\n            imgElement.addEventListener(\"change\", this.handleImages, false);\r\n            userAvatar.addEventListener(\"change\", this.changeAvatar, false);\r\n            logInBtn.addEventListener('click', () => {\r\n                this.logIn()\r\n            }, false);\r\n            sendBtn.addEventListener('click', () => {\r\n                messageHelper.submitMessage()\r\n            }, false);\r\n            signUpBtn.addEventListener('click', () => {\r\n                this.signUp()\r\n            }, false);\r\n            logOutBtn.addEventListener('click', () => {\r\n                this.disconnectUser();\r\n            }, false);\r\n            removeUserBtn.addEventListener('click', () => {\r\n                this.removeUser();\r\n            }, false);\r\n            input.addEventListener(\"keyup\", (e) => {\r\n                if (/*e.ctrlKey &&*/ e.keyCode == 13) {\r\n                    messageHelper.submitMessage();\r\n                    e.preventDefault()\r\n                } else {\r\n                    var currentUser = this.getCurrentUser();\r\n                    var msg = messageHelper.createMessage('typing', `${currentUser} is typing ...`, 'admin');\r\n                    if (!isTyping) {\r\n                        isTyping = true;\r\n                        setTimeout(() => {\r\n                            socket.send(JSON.stringify(msg));\r\n\r\n                        }, 200);\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n            }, false);\r\n        },\r\n        handleMessage  (event){\r\n            var incomingMessage = JSON.parse(event.data);\r\n            switch (incomingMessage.type) {\r\n                case 'typing':\r\n                    var type = document.getElementById(\"type-status\");\r\n                    type.innerHTML = incomingMessage.text;\r\n                    window.setTimeout(() => {\r\n                        isTyping = false;\r\n                        type.innerHTML = '';\r\n                    }, 2500);\r\n                    break;\r\n                case 'join':\r\n                    messageHelper.showMessage(incomingMessage);\r\n                    clientsHelper.connectClient(incomingMessage.username);\r\n                    break;\r\n                case 'leave':\r\n                    messageHelper.showMessage(incomingMessage);\r\n                    clientsHelper.disconnectClient(incomingMessage.username);\r\n                    break;\r\n                case 'avatar':\r\n                    clientsHelper.setClientAvatar(incomingMessage);\r\n                    break;\r\n                default:\r\n                    messageHelper.showMessage(incomingMessage);\r\n                    break\r\n            }\r\n        },\r\n        signUp  () {\r\n            var form = document.forms['signUpForm'];\r\n            var nickname = form.elements[\"signupUser\"].value;\r\n            var password = form.elements[\"signupPassword\"].value;\r\n            if (nickname) {\r\n                clientsHelper.isClientExists(nickname).then((isClientNew) => {\r\n                    if (isClientNew) {\r\n                        clientsHelper.addClient({nickname, password}).then(()=> {\r\n                            this.connectUser(nickname);\r\n                        });\r\n                    } else {\r\n                        alert('nickname ' + nickname + ' already exists. Please choose another name')\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        logIn () {\r\n            var form = document.forms['logInForm'];\r\n            var nickname = form.elements[\"loginUser\"].value;\r\n            var password = form.elements[\"loginPassword\"].value;\r\n            if (nickname) {\r\n                clientsHelper.isClientAuthorized(nickname, password).then((isClientAuthorized) => {\r\n                    if (isClientAuthorized) {\r\n                        this.connectUser(nickname);\r\n                    } else {\r\n                        alert('Nickname or password is wrong')\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        removeUser(){\r\n            var user = sessionStorage.getItem('currentUser');\r\n            var confirmation = confirm(`Вы уверенры что хотите удалить пользователя ${user}?`);\r\n            if (confirmation) {\r\n                clientsHelper.removeClient().then(()=> {\r\n                    this.disconnectUser(user);\r\n                });\r\n            }\r\n        },\r\n        connectUser (username) {\r\n            domHelper.unlock();\r\n            historyHelper.showHistory();\r\n            this.setCurrentUser(username);\r\n            var msg = messageHelper.createMessage('join', `${username} joined to chat`, 'admin', username);\r\n            socket.send(JSON.stringify(msg));\r\n            setTimeout(()=>{\r\n                historyHelper.updateHistory(msg);\r\n            }, 1000)\r\n        },\r\n        disconnectUser (username) {\r\n            var user = username || this.getCurrentUser();\r\n            var msg = messageHelper.createMessage('leave', `${user} disconnected`, 'admin', user);\r\n            historyHelper.updateHistory(msg);\r\n            socket.send(JSON.stringify(msg));\r\n            this.setCurrentUser('');\r\n            domHelper.lock();\r\n        },\r\n        changeAvatar (){\r\n            var file = this.files && this.files[0];\r\n            var reader = new FileReader();\r\n            reader.addEventListener(\"load\", function () {\r\n                var user = sessionStorage.getItem('currentUser');\r\n                var msg = messageHelper.createMessage('avatar', reader.result, 'admin', user);\r\n                socket.send(JSON.stringify(msg));\r\n                var msgAdmin = messageHelper.createMessage('message', `User ${user} changed avatar`, 'admin', user);\r\n                socket.send(JSON.stringify(msgAdmin));\r\n                historyHelper.updateHistory(msgAdmin);\r\n            });\r\n            if (file) {\r\n                reader.readAsDataURL(file)\r\n            }\r\n        },\r\n        handleImages () {\r\n            var file = this.files && this.files[0];\r\n            var reader = new FileReader();\r\n            reader.addEventListener(\"load\", function () {\r\n                var user = sessionStorage.getItem('currentUser');\r\n                var msg = messageHelper.createMessage('image', reader.result, user);\r\n                historyHelper.updateHistory(msg);\r\n                socket.send(JSON.stringify(msg));\r\n            }, false);\r\n            if (file) {\r\n                reader.readAsDataURL(file)\r\n            }\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/event-handler.js\n **/","module.exports = function (socket) {\r\n    const input = document.getElementById(\"messageTxt\"),\r\n        sendBtn = document.getElementById(\"sendMessage\"),\r\n        signUpBtn = document.getElementById(\"signUpBtn\"),\r\n        logInBtn = document.getElementById(\"logInBtn\"),\r\n        logOutBtn = document.getElementById(\"logOutBtn\"),\r\n        userAvatar = document.getElementById(\"avatarImg\"),\r\n        msgsBlock = document.getElementById('messages'),\r\n        chat = document.getElementById('nodejs-chat'),\r\n        offlineImgSrc = 'images/offline.png',\r\n        defaultImgSrc = 'images/face.png';\r\n    return {\r\n        createClient (msg) {\r\n            var currentUser = sessionStorage.getItem('currentUser');\r\n            var fragment = document.createDocumentFragment();\r\n            var messageElem = fragment.appendChild(document.createElement('li'));\r\n            var img = messageElem.appendChild(document.createElement('img'));\r\n            var info = messageElem.appendChild(document.createElement('div'));\r\n            var user = info.appendChild(document.createElement('div'));\r\n            var status = info.appendChild(document.createElement('div'));\r\n            var statusText = msg.online ? 'online' : 'offline';\r\n            status.appendChild(document.createTextNode(statusText));\r\n            user.appendChild(document.createTextNode(msg.name));\r\n            info.className = \"info\";\r\n            user.className = \"user\";\r\n            status.className = msg.online ? \"status on\" : \"status off\";\r\n            var imgSrc = msg.avatar ? msg.avatar.replace(/ /ig, '+') : defaultImgSrc;\r\n            img.setAttribute('src', imgSrc);\r\n            img.setAttribute('width', '50');\r\n            img.setAttribute('height', '50');\r\n            if (msg.name === currentUser) {\r\n                user.classList.add('currentUser');\r\n            }\r\n            document.getElementById('clients').appendChild(fragment);\r\n        },\r\n        updateClientStatus(msg){\r\n            var clientsInfo = document.querySelectorAll('#clients .info');\r\n            var statusText = msg.online ? 'online' : 'offline';\r\n            [].forEach.call(clientsInfo, function (el) {\r\n                if (el.querySelector('.user').innerHTML === msg.name) {\r\n                    var status = el.querySelector('.status');\r\n                    status.className = msg.online ? \"status on\" : \"status off\";\r\n                    status.innerHTML = statusText;\r\n                }\r\n            });\r\n        },\r\n        addMessage (msg) {\r\n            var fragment = document.createDocumentFragment();\r\n            var messageElem = fragment.appendChild(document.createElement('li'));\r\n            var messageInfo = messageElem.appendChild(document.createElement('div'));\r\n            var messageText = messageElem.appendChild(document.createElement('div'));\r\n            if (msg.type === 'image') {\r\n                var img = document.createElement('img');\r\n                var imgSrc = msg.text.replace(/ /ig, '+'); // fix base64 format after saving in MongoLab\r\n                img.setAttribute('src', imgSrc);\r\n                img.setAttribute('width', '50');\r\n                img.setAttribute('height', '50');\r\n                messageText.appendChild(img);\r\n            } else {\r\n                messageText.appendChild(document.createTextNode(msg.text));\r\n            }\r\n            var messageInfoName = messageInfo.appendChild(document.createElement('span'));\r\n            var messageInfoTime = messageInfo.appendChild(document.createElement('span'));\r\n            messageElem.className = \"i\";\r\n            messageInfo.className = \"head\";\r\n            messageText.className = \"message\";\r\n            messageInfoTime.className = \"time\";\r\n            messageInfoName.className = \"name\";\r\n\r\n            messageInfoTime.appendChild(document.createTextNode(msg.date));\r\n            messageInfoName.appendChild(document.createTextNode(msg.author));\r\n            if (msg.author === 'admin') {\r\n                messageElem.classList.add('admin');\r\n            }\r\n            if (sessionStorage.getItem('currentUser') === msg.author) {\r\n                messageElem.classList.add('currentUser');\r\n            }\r\n            return fragment;\r\n        },\r\n        unlock   () {\r\n            input.setAttribute('placeholder', 'Type the message here');\r\n            userAvatar.removeAttribute('disabled');\r\n            input.removeAttribute('disabled');\r\n            sendBtn.removeAttribute('disabled');\r\n            msgsBlock.removeAttribute('disabled');\r\n            chat.classList.toggle('locked');\r\n        },\r\n        lock   () {\r\n            input.value = '';\r\n            input.setAttribute('placeholder', 'Please Sign Up or Log In');\r\n            chat.classList.toggle('locked');\r\n            userAvatar.setAttribute('disabled', 'disabled');\r\n            input.setAttribute('disabled', 'disabled');\r\n            sendBtn.setAttribute('disabled', 'disabled');\r\n            msgsBlock.innerHTML = '';\r\n            msgsBlock.setAttribute('disabled', 'disabled');\r\n            document.getElementById('currentUser').innerHTML = '';\r\n            document.getElementById('avatar').src = offlineImgSrc;\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/dom.js\n **/","module.exports = function () {\r\n    var domHelper = require('./dom')();\r\n    var requestHelper = require('./request')();\r\n    return {\r\n        getHistory () {\r\n            return requestHelper.request('/messages', 'GET').then((data) => {\r\n                return JSON.parse(data);\r\n            });\r\n        },\r\n        updateHistory (msg) {\r\n            var time = new Date(msg.date);\r\n            var dateStr = time.toLocaleDateString('en-US');\r\n            var timeStr = time.toLocaleTimeString();\r\n            msg.date = `${dateStr}  ${timeStr}`;\r\n            return requestHelper.request('/messages', 'POST', msg).then(() => {\r\n                console.log('History POST message')\r\n            });\r\n        },\r\n        showHistory   (length = 20) {\r\n            this.getHistory().then((messages) => {\r\n                var msgBlock = document.getElementById('messages');\r\n                msgBlock.style.display = 'block';\r\n                for (var i = messages.length; i >= messages.length - length; i--) {\r\n                    var msg = messages[i];\r\n                    if (msg) {\r\n                        var messageElem = domHelper.addMessage(msg);\r\n                        msgBlock.insertBefore(messageElem, msgBlock.firstChild)\r\n                    }\r\n                }\r\n                var scrollArea = document.getElementById('messages');\r\n                scrollArea.scrollTop = scrollArea.scrollHeight;\r\n            });\r\n\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/history.js\n **/","module.exports = function () {\r\n    return {\r\n        request(url, method, data) {\r\n            return new Promise((resolve, reject) => {\r\n                const req = new XMLHttpRequest();\r\n                req.open(method, url);\r\n                req.onload = () => req.status === 200 ? resolve(req.response) : reject(Error(req.statusText));\r\n                req.onerror = (e) => reject(Error(`Network Error: ${e}`));\r\n                if (method = 'POST') {\r\n                    req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n                }\r\n                req.send(this.param(data));\r\n            });\r\n        },\r\n        param(object) {\r\n            var encodedString = '';\r\n            for (var prop in object) {\r\n                if (object.hasOwnProperty(prop)) {\r\n                    if (encodedString.length > 0) {\r\n                        encodedString += '&';\r\n                    }\r\n                    encodedString += encodeURI(prop + '=' + object[prop]);\r\n                }\r\n            }\r\n            return encodedString;\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/request.js\n **/","module.exports = function () {\r\n    const domHelper = require('./dom')();\r\n    const requestHelper = require('./request')();\r\n    return {\r\n        getClients () {\r\n            return requestHelper.request('/clients', 'GET').then((data) => {\r\n                return JSON.parse(data);\r\n            });\r\n        },\r\n        isClientOnline (username) {\r\n            return this.getClients().then((clients) => {\r\n                return clients[username].online;\r\n            });\r\n        },\r\n        showClients () {\r\n            document.getElementById('clients').innerHTML = '';\r\n            this.getClients().then(function (clients) {\r\n                for (let key in clients) {\r\n                    domHelper.createClient(clients[key]);\r\n                }\r\n            })\r\n        },\r\n        isClientExists (username) {\r\n            return this.getClients().then((clients) => {\r\n                return !clients[username];\r\n            })\r\n        },\r\n        isClientAuthorized(username, password) {\r\n            return this.getClients().then((clients) => {\r\n                return clients[username] && clients[username].password === password;\r\n            })\r\n        },\r\n        connectClient(username){\r\n            var currentUser = sessionStorage.getItem('currentUser');\r\n            var updateData = {\r\n                online: true,\r\n                name: username\r\n            };\r\n            this.updateClient(updateData);\r\n            username && (currentUser === username) && this.getClients().then((clients) => {\r\n                document.getElementById('avatar').src = clients[username].avatar.replace(/ /ig, '+')\r\n            });\r\n        },\r\n        disconnectClient(username){\r\n            this.updateClient({\r\n                online: false,\r\n                name: username\r\n            })\r\n        },\r\n        updateClient(data){\r\n            requestHelper.request('/clients', 'PUT', data).then(() => {\r\n                this.showClients();\r\n                //domHelper.updateClientStatus(data);\r\n            });\r\n        },\r\n        removeClient(){\r\n            var username = sessionStorage.getItem('currentUser');\r\n            return requestHelper.request('/clients', 'DELETE', {username}).then(() => {\r\n            });\r\n        },\r\n        setClientAvatar(msg){\r\n            var username = sessionStorage.getItem('currentUser');\r\n            if (username === msg.username) {\r\n                document.getElementById('avatar').src = msg.text;\r\n            }\r\n            this.updateClient({\r\n                avatar: msg.text,\r\n                name: msg.username\r\n            });\r\n        },\r\n        addClient(currentUser){\r\n            return requestHelper.request('/clients', 'POST', currentUser).then(() => {\r\n               // this.showClients();\r\n            });\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/clients.js\n **/","module.exports = function (socket) {\r\n    var domHelper = require('./dom')();\r\n    var historyHelper = require('./history')();\r\n    var input = document.getElementById(\"messageTxt\");\r\n    return {\r\n        createMessage (type, text, author, username) {\r\n            return {type, text, author, date: Date.now(), username}\r\n        },\r\n        showMessage (msg) {\r\n            var time = new Date(msg.date);\r\n            var dateStr = time.toLocaleDateString('en-US');\r\n            var timeStr = time.toLocaleTimeString();\r\n            msg.date = `${dateStr}  ${timeStr}`;\r\n            var messageElem = domHelper.addMessage(msg);\r\n            if(!document.getElementById('nodejs-chat').classList.contains('locked')) {\r\n                var scrollArea = document.getElementById('messages');\r\n                scrollArea.appendChild(messageElem);\r\n                scrollArea.scrollTop = scrollArea.scrollHeight;\r\n            }\r\n        },\r\n        submitMessage () {\r\n            var value = input.value;\r\n            if (!value) {\r\n                return;\r\n            }\r\n            var user = sessionStorage.getItem('currentUser');\r\n            var msg = this.createMessage('message', value, user);\r\n            historyHelper.updateHistory(msg);\r\n            socket.send(JSON.stringify(msg));\r\n            input.value = '';\r\n            this.submitBotMessage();\r\n        },\r\n        submitBotMessage (){\r\n            var text = this.botMsgs[Math.floor(Math.random() * this.botMsgs.length)];\r\n            var msg = this.createMessage('message', text, 'Lola');\r\n            var msg2 = this.createMessage('typing', 'Lola is typing ...', 'admin');\r\n            setTimeout(() => {\r\n                socket.send(JSON.stringify(msg2));\r\n            }, 500);\r\n            setTimeout(function () {\r\n                socket.send(JSON.stringify(msg));\r\n                historyHelper.updateHistory(msg);\r\n            }, 3000)\r\n        },\r\n        botMsgs: [\"Добро пожаловать в наш чатик!\", \"Я счастлива!\", \"Вот это новость\", \"А расскажи о себе!\",\"Lol\", \"Помни, чай нужно пить с малиновым вареньем!\", \"Je parle francais tres bien, tu peux le faire\", \"А мы тут плюшками балуемся...\", \"Да ну это все...Я наверное пойду.\", \"Не уходи, мы же тебя любим!\"]\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/message.js\n **/"],"sourceRoot":""}