{"version":3,"sources":["webpack:///webpack/bootstrap 43c580aea06296532b4a","webpack:///./public/scripts/ws-client.js","webpack:///./public/scripts/event-handler.js","webpack:///./public/scripts/dom.js","webpack:///./public/scripts/history.js","webpack:///./public/scripts/request.js","webpack:///./public/scripts/clients.js","webpack:///./public/scripts/message.js"],"names":["window","WebSocket","document","body","innerHTML","socket","helper","require","clientsHelper","init","onopen","currentUser","getCurrentUser","connectUser","showClients","onerror","e","send","onclose","disconnectUser","onmessage","event","handleMessage","module","exports","domHelper","historyHelper","messageHelper","input","getElementById","sendBtn","signUpBtn","logInBtn","logOutBtn","imgElement","userAvatar","removeUserBtn","isTyping","sessionStorage","getItem","setCurrentUser","username","setItem","addEventListener","handleImages","changeAvatar","logIn","submitMessage","signUp","removeUser","keyCode","preventDefault","msg","createMessage","setTimeout","JSON","stringify","incomingMessage","parse","data","user","type","text","setClientAvatar","isClientOnline","then","showMessage","connectClient","form","forms","nickname","elements","value","password","isClientNew","addClient","alert","isClientAuthorized","confirmation","confirm","removeClient","unlock","showHistory","lock","file","files","console","log","reader","FileReader","result","readAsDataURL","tabs","offlineImgSrc","defaultImgSrc","createClient","fragment","createDocumentFragment","messageElem","appendChild","createElement","img","info","status","statusText","online","createTextNode","name","className","setAttribute","avatar","classList","add","addMessage","messageInfo","messageText","messageInfoName","messageInfoTime","date","author","removeAttribute","style","display","src","requestHelper","getHistory","request","updateHistory","length","messages","msgBlock","i","insertBefore","firstChild","url","method","Promise","resolve","reject","req","XMLHttpRequest","open","onload","response","Error","setRequestHeader","param","object","encodedString","prop","hasOwnProperty","encodeURI","getClients","clients","key","update","Date","now","time","dateStr","toLocaleDateString","timeStr","toLocaleTimeString","scrollArea","scrollTop","scrollHeight","submitBotMessage","botMsgs","Math","floor","random","msg2"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 43c580aea06296532b4a\n **/","if (!window.WebSocket) {\r\n    document.body.innerHTML = 'WebSocket is not supported in this browser.';\r\n}\r\n\r\nvar socket = new WebSocket('ws://localhost:3001');\r\nvar helper = require('./event-handler')(socket);\r\nvar clientsHelper = require('./clients')();\r\n\r\n\r\nhelper.init();\r\n\r\nsocket.onopen = ()  => {\r\n    var currentUser = helper.getCurrentUser();\r\n    currentUser ? helper.connectUser(currentUser) : clientsHelper.showClients();\r\n};\r\nsocket.onerror = (e)  => {\r\n    socket.send('error' + e);\r\n};\r\nsocket.onclose = ()  => {\r\n    helper.disconnectUser();\r\n};\r\nsocket.onmessage = (event)  => {\r\n    helper.handleMessage(event);\r\n\r\n};\r\n\r\n\r\n\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/ws-client.js\n **/","module.exports = function (socket) {\r\n    var domHelper = require('./dom')();\r\n    var historyHelper = require('./history')();\r\n    var clientsHelper = require('./clients')();\r\n    var messageHelper = require('./message')(socket);\r\n    var input = document.getElementById(\"messageTxt\");\r\n    var sendBtn = document.getElementById(\"sendMessage\");\r\n    var signUpBtn = document.getElementById(\"signUpBtn\");\r\n    var logInBtn = document.getElementById(\"logInBtn\");\r\n    var logOutBtn = document.getElementById(\"logOutBtn\");\r\n    var imgElement = document.getElementById(\"imgElem\");\r\n    var userAvatar = document.getElementById(\"avatarImg\");\r\n    var removeUserBtn = document.getElementById(\"removeUser\");\r\n    var isTyping = false;\r\n    return {\r\n        getCurrentUser () {\r\n            return sessionStorage.getItem('currentUser');\r\n        },\r\n        setCurrentUser (username = '') {\r\n            document.getElementById('currentUser').innerHTML = username;\r\n            sessionStorage.setItem('currentUser', username);\r\n        },\r\n        init () {\r\n            imgElement.addEventListener(\"change\", this.handleImages, false);\r\n            userAvatar.addEventListener(\"change\", this.changeAvatar, false);\r\n            logInBtn.addEventListener('click', () => {\r\n                this.logIn()\r\n            }, false);\r\n            sendBtn.addEventListener('click', () => {\r\n                messageHelper.submitMessage()\r\n            }, false);\r\n            signUpBtn.addEventListener('click', () => {\r\n                this.signUp()\r\n            }, false);\r\n            logOutBtn.addEventListener('click', () => {\r\n                this.disconnectUser();\r\n            }, false);\r\n            removeUserBtn.addEventListener('click', () => {\r\n                this.removeUser();\r\n            }, false);\r\n            input.addEventListener(\"keyup\", (e) => {\r\n                if (/*e.ctrlKey &&*/ e.keyCode == 13) {\r\n                    messageHelper.submitMessage();\r\n                    e.preventDefault()\r\n                } else {\r\n                    var currentUser = this.getCurrentUser();\r\n                    var msg = messageHelper.createMessage('typing', `${currentUser} is typing ...`, 'admin');\r\n                    if (!isTyping) {\r\n                        isTyping = true;\r\n                        setTimeout(() => {\r\n                            socket.send(JSON.stringify(msg));\r\n\r\n                        }, 200);\r\n                    } else {\r\n                        return false;\r\n                    }\r\n                }\r\n            }, false);\r\n        },\r\n        handleMessage  (event){\r\n            var incomingMessage = JSON.parse(event.data);\r\n            var user = this.getCurrentUser();\r\n            switch (incomingMessage.type) {\r\n                case 'typing':\r\n                    var type = document.getElementById(\"type-status\");\r\n                    type.innerHTML = incomingMessage.text;\r\n                    window.setTimeout(()  => {\r\n                        isTyping = false;\r\n                        type.innerHTML = '';\r\n                    }, 3000);\r\n                    break;\r\n                case 'avatar':\r\n                    clientsHelper.setClientAvatar(incomingMessage);\r\n                    var msg = messageHelper.createMessage('message', `${user} changed avatar`, 'admin', user)\r\n                    socket.send(JSON.stringify(msg));\r\n                    break;\r\n                case 'leave':\r\n                    user && clientsHelper.isClientOnline(user).then((isClientOnline) => {\r\n                        if (isClientOnline) {\r\n                            messageHelper.showMessage(incomingMessage);\r\n                        }\r\n                    });\r\n                    clientsHelper.showClients();\r\n                    break;\r\n                case 'join':\r\n                    user && clientsHelper.isClientOnline(user).then((isClientOnline) => {\r\n                        if (isClientOnline) {\r\n                            messageHelper.showMessage(incomingMessage);\r\n                            clientsHelper.connectClient(incomingMessage.username);\r\n                        }\r\n                    });\r\n                    clientsHelper.showClients();\r\n                    break;\r\n                default:\r\n                    user && clientsHelper.isClientOnline(user).then((isClientOnline) => {\r\n                        if (isClientOnline) {\r\n                            messageHelper.showMessage(incomingMessage);\r\n                        }\r\n                    });\r\n                    break\r\n            }\r\n        },\r\n        signUp  () {\r\n            var form = document.forms['signUpForm'];\r\n            var nickname = form.elements[\"signupUser\"].value;\r\n            var password = form.elements[\"signupPassword\"].value;\r\n            if (nickname) {\r\n                clientsHelper.isClientNew(nickname).then((isClientNew) => {\r\n                    if (isClientNew) {\r\n                        clientsHelper.addClient({nickname, password}).then(()=> {\r\n                            this.connectUser(nickname);\r\n                        });\r\n                    } else {\r\n                        alert('nickname ' + nickname + ' already exists. Please choose another name')\r\n                    }\r\n                })\r\n            }\r\n        },\r\n        logIn () {\r\n            var form = document.forms['logInForm'];\r\n            var nickname = form.elements[\"loginUser\"].value;\r\n            var password = form.elements[\"loginPassword\"].value;\r\n            if (nickname) {\r\n                clientsHelper.isClientAuthorized(nickname, password).then((isClientAuthorized) => {\r\n                    if (isClientAuthorized) {\r\n                        this.connectUser(nickname);\r\n                    } else {\r\n                        alert('Nickname or password is wrong')\r\n                    }\r\n                })\r\n\r\n            }\r\n        },\r\n        removeUser(){\r\n            var user = sessionStorage.getItem('currentUser');\r\n            var confirmation = confirm(`Вы уверенры что хотите удалить пользователя ${user}?`);\r\n            if (confirmation) {\r\n                clientsHelper.removeClient().then(()=> {\r\n                    this.disconnectUser(user);\r\n                });\r\n            }\r\n        },\r\n        connectUser (username) {\r\n            this.setCurrentUser(username);\r\n            var msg = messageHelper.createMessage('join', `${username} joined to chat`, 'admin', username)\r\n            socket.send(JSON.stringify(msg));\r\n            domHelper.unlock();\r\n            historyHelper.showHistory();\r\n        },\r\n        disconnectUser (username) {\r\n            var user = username || this.getCurrentUser();\r\n            var msg = messageHelper.createMessage('leave', `${user} disconnected`, 'admin', user)\r\n            socket.send(JSON.stringify(msg));\r\n            this.setCurrentUser('');\r\n            domHelper.lock();\r\n        },\r\n        changeAvatar (){\r\n            var file = this.files && this.files[0];\r\n            console.log(file)\r\n            var reader = new FileReader();\r\n            reader.addEventListener(\"load\", function () {\r\n                var user = sessionStorage.getItem('currentUser');\r\n                var msg = messageHelper.createMessage('avatar', reader.result, 'admin', user);\r\n                socket.send(JSON.stringify(msg));\r\n            });\r\n            if (file) {\r\n                reader.readAsDataURL(file)\r\n            }\r\n        },\r\n        handleImages () {\r\n            var file = this.files && this.files[0];\r\n            var reader = new FileReader();\r\n            reader.addEventListener(\"load\", function () {\r\n                var user = sessionStorage.getItem('currentUser');\r\n                var msg = messageHelper.createMessage('image', reader.result, user);\r\n                socket.send(JSON.stringify(msg));\r\n            }, false);\r\n            if (file) {\r\n                reader.readAsDataURL(file)\r\n            }\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/event-handler.js\n **/","module.exports = function (socket) {\r\n    var input = document.getElementById(\"messageTxt\");\r\n    var sendBtn = document.getElementById(\"sendMessage\");\r\n    var signUpBtn = document.getElementById(\"signUpBtn\");\r\n    var logInBtn = document.getElementById(\"logInBtn\");\r\n    var logOutBtn = document.getElementById(\"logOutBtn\");\r\n    var userAvatar = document.getElementById(\"avatarImg\");\r\n    var tabs = document.getElementById(\"tab-area\");\r\n    const offlineImgSrc = 'images/offline.png';\r\n    const defaultImgSrc = 'images/face.png';\r\n    return {\r\n        createClient (msg) {\r\n            var currentUser = sessionStorage.getItem('currentUser');\r\n            var fragment = document.createDocumentFragment();\r\n            var messageElem = fragment.appendChild(document.createElement('li'));\r\n            var img = messageElem.appendChild(document.createElement('img'));\r\n            var info = messageElem.appendChild(document.createElement('div'));\r\n            var user = info.appendChild(document.createElement('div'));\r\n            var status = info.appendChild(document.createElement('div'));\r\n            var statusText = msg.online ? 'online' : 'offline';\r\n            status.appendChild(document.createTextNode(statusText));\r\n            user.appendChild(document.createTextNode(msg.name));\r\n            info.className = \"info\";\r\n            user.className = \"user\";\r\n            status.className = msg.online ? \"status on\" : \"status off\";\r\n            img.setAttribute('src', msg.avatar || defaultImgSrc );\r\n            img.setAttribute('width', '50');\r\n            img.setAttribute('height', '50');\r\n            if (msg.name === currentUser) {\r\n                user.classList.add('currentUser');\r\n            }\r\n            document.getElementById('clients').appendChild(fragment);\r\n        },\r\n        addMessage (msg) {\r\n            var fragment = document.createDocumentFragment();\r\n            var messageElem = fragment.appendChild(document.createElement('li'));\r\n            var messageInfo = messageElem.appendChild(document.createElement('div'));\r\n            var messageText = messageElem.appendChild(document.createElement('div'));\r\n            if (msg.type === 'image') {\r\n                var img = document.createElement('img');\r\n                img.setAttribute('src', msg.text);\r\n                img.setAttribute('width', '50');\r\n                img.setAttribute('height', '50');\r\n                messageText.appendChild(img);\r\n            } else {\r\n                messageText.appendChild(document.createTextNode(msg.text));\r\n            }\r\n            var messageInfoName = messageInfo.appendChild(document.createElement('span'));\r\n            var messageInfoTime = messageInfo.appendChild(document.createElement('span'));\r\n            messageElem.className = \"i\";\r\n            messageInfo.className = \"head\";\r\n            messageText.className = \"message\";\r\n            messageInfoTime.className = \"time\";\r\n            messageInfoName.className = \"name\";\r\n\r\n            messageInfoTime.appendChild(document.createTextNode(msg.date));\r\n            messageInfoName.appendChild(document.createTextNode(msg.author));\r\n            if (msg.author === 'admin') {\r\n                messageElem.classList.add('admin');\r\n            }\r\n            if (sessionStorage.getItem('currentUser') === msg.author) {\r\n                messageElem.classList.add('currentUser');\r\n            }\r\n            return fragment;\r\n        },\r\n        unlock   () {\r\n            input.setAttribute('placeholder', 'Type the message here');\r\n            userAvatar.removeAttribute('disabled');\r\n            input.removeAttribute('disabled');\r\n            sendBtn.removeAttribute('disabled');\r\n            tabs.style.display = 'none';\r\n            logOutBtn.style.display = 'block';\r\n        },\r\n        lock   () {\r\n            input.value = '';\r\n            input.setAttribute('placeholder', 'Please Sign Up or Log In');\r\n            userAvatar.setAttribute('disabled', 'disabled');\r\n            input.setAttribute('disabled', 'disabled');\r\n            sendBtn.setAttribute('disabled', 'disabled');\r\n            tabs.style.display = 'block';\r\n            logOutBtn.style.display = 'none';\r\n            document.getElementById('messages').innerHTML = '';\r\n            document.getElementById('currentUser').innerHTML = '';\r\n            document.getElementById('avatar').src = offlineImgSrc;\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/dom.js\n **/","module.exports = function () {\r\n    var domHelper = require('./dom')();\r\n    var requestHelper = require('./request')();\r\n    return {\r\n        getHistory () {\r\n            //return JSON.parse(localStorage.getItem('messageHistory')) || [];\r\n            return requestHelper.request('/messages', 'GET').then((data) => {\r\n                return JSON.parse(data);\r\n            });\r\n        },\r\n        updateHistory (msg) {\r\n            return requestHelper.request('/messages', 'POST', msg).then(() => {\r\n                console.log('History POST message')\r\n            });\r\n        },\r\n        showHistory   (length = 20) {\r\n            this.getHistory().then((messages) => {\r\n                var msgBlock = document.getElementById('messages');\r\n                msgBlock.style.display = 'block';\r\n                for (var i = messages.length; i >= messages.length - length; i--) {\r\n                    var msg = messages[i];\r\n                    if (msg) {\r\n                        var messageElem = domHelper.addMessage(msg);\r\n                        msgBlock.insertBefore(messageElem, msgBlock.firstChild)\r\n                    }\r\n                }\r\n            });\r\n\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/history.js\n **/","module.exports = function () {\r\n    return {\r\n        request(url, method, data) {\r\n            return new Promise((resolve, reject) => {\r\n                const req = new XMLHttpRequest();\r\n                req.open(method, url);\r\n                req.onload = () => req.status === 200 ? resolve(req.response) : reject(Error(req.statusText));\r\n                req.onerror = (e) => reject(Error(`Network Error: ${e}`));\r\n                if (method = 'POST') {\r\n                    req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\r\n                }\r\n                req.send(this.param(data));\r\n            });\r\n        },\r\n        param(object) {\r\n            var encodedString = '';\r\n            for (var prop in object) {\r\n                if (object.hasOwnProperty(prop)) {\r\n                    if (encodedString.length > 0) {\r\n                        encodedString += '&';\r\n                    }\r\n                    encodedString += encodeURI(prop + '=' + object[prop]);\r\n                }\r\n            }\r\n            return encodedString;\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/request.js\n **/","module.exports = function () {\r\n    var domHelper = require('./dom')();\r\n    var requestHelper = require('./request')();\r\n    return {\r\n        getClients () {\r\n            return requestHelper.request('/clients', 'GET').then((data) => {\r\n                return JSON.parse(data);\r\n            });\r\n        },\r\n        isClientOnline (username) {\r\n            return this.getClients().then((clients) => {\r\n                return clients[username].online;\r\n            });\r\n        },\r\n        showClients () {\r\n            document.getElementById('clients').innerHTML = '';\r\n            this.getClients().then(function (clients) {\r\n                for (var key in clients) {\r\n                    domHelper.createClient(clients[key]);\r\n                }\r\n            })\r\n        },\r\n        isClientNew (username) {\r\n            return this.getClients().then((clients) => {\r\n                return !clients[username];\r\n            })\r\n        },\r\n        isClientAuthorized(username, password) {\r\n            return this.getClients().then((clients) => {\r\n                return clients[username] && clients[username].password === password;\r\n            })\r\n\r\n        },\r\n        connectClient(username){\r\n            username && this.getClients().then((clients) => {\r\n                document.getElementById('avatar').src = clients[username].avatar\r\n            });\r\n\r\n        },\r\n        removeClient(){\r\n            var username = sessionStorage.getItem('currentUser');\r\n            return requestHelper.request('/clients', 'DELETE', {username}).then(() => {\r\n            });\r\n        },\r\n        setClientAvatar(msg){\r\n            document.getElementById('avatar').src = msg.text;\r\n            var update = {\r\n                avatar: msg.text,\r\n                name: msg.username\r\n            }\r\n            requestHelper.request('/clients', 'PUT', update).then(() => {\r\n                console.log('PUT message')\r\n                this.showClients();\r\n            });\r\n        },\r\n        addClient(currentUser){\r\n            return requestHelper.request('/clients', 'POST', currentUser).then(() => {\r\n                console.log('POST message')\r\n                this.showClients();\r\n            });\r\n        }\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/clients.js\n **/","module.exports = function (socket) {\r\n    var domHelper = require('./dom')();\r\n    var historyHelper = require('./history')();\r\n    var input = document.getElementById(\"messageTxt\");\r\n    return {\r\n        createMessage (type, text, author, username) {\r\n            return {type, text, author, date: Date.now(), username}\r\n        },\r\n        showMessage (msg) {\r\n            var time = new Date(msg.date);\r\n            var dateStr = time.toLocaleDateString('en-US');\r\n            var timeStr = time.toLocaleTimeString();\r\n            msg.date = `${dateStr}  ${timeStr}`;\r\n            var messageElem = domHelper.addMessage(msg);\r\n            historyHelper.updateHistory(msg);\r\n            var scrollArea = document.getElementById('messages');\r\n            scrollArea.appendChild(messageElem);\r\n            scrollArea.scrollTop = scrollArea.scrollHeight;\r\n        },\r\n        submitMessage () {\r\n            var value = input.value;\r\n            if (!value) {\r\n                return;\r\n            }\r\n            var user = sessionStorage.getItem('currentUser');\r\n            var msg = this.createMessage('message', value, user);\r\n            socket.send(JSON.stringify(msg));\r\n            input.value = '';\r\n            this.submitBotMessage();\r\n        },\r\n        submitBotMessage (){\r\n            var text = this.botMsgs[Math.floor(Math.random() * this.botMsgs.length)];\r\n            var msg = this.createMessage('message', text, 'Lola');\r\n            var msg2 = this.createMessage('typing', 'Lola is typing ...', 'admin');\r\n            setTimeout(() => {\r\n                socket.send(JSON.stringify(msg2));\r\n            }, 500);\r\n            setTimeout(function () {\r\n                socket.send(JSON.stringify(msg));\r\n            }, 3000)\r\n        },\r\n        botMsgs: [\"Добро пожаловать в наш чатик!\", \"Помни, чай нужно пить с малиновым вареньем!\", \"А мы тут плюшками балуемся...\", \"Да ну это все...\", \"Не уходи, мы же тебя любим!\"]\r\n    }\r\n};\n\n\n/** WEBPACK FOOTER **\n ** ./public/scripts/message.js\n **/"],"sourceRoot":""}